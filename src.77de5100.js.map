{"version":3,"sources":["logger.ts","../node_modules/fetch-jsonp/build/fetch-jsonp.js","services/reddit.ts","state.ts","index.ts"],"names":[],"mappings":"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","file":"src.77de5100.js","sourceRoot":"../src","sourcesContent":["export const Logger = ({ logLevel }) => {\n  return {\n    debug: (context, ...msg) => {\n      if (logLevel.includes(\"debug\")) console.log(`[${context}]`, ...msg);\n    },\n  };\n};\n","(function (global, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define(['exports', 'module'], factory);\n  } else if (typeof exports !== 'undefined' && typeof module !== 'undefined') {\n    factory(exports, module);\n  } else {\n    var mod = {\n      exports: {}\n    };\n    factory(mod.exports, mod);\n    global.fetchJsonp = mod.exports;\n  }\n})(this, function (exports, module) {\n  'use strict';\n\n  var defaultOptions = {\n    timeout: 5000,\n    jsonpCallback: 'callback',\n    jsonpCallbackFunction: null\n  };\n\n  function generateCallbackFunction() {\n    return 'jsonp_' + Date.now() + '_' + Math.ceil(Math.random() * 100000);\n  }\n\n  function clearFunction(functionName) {\n    // IE8 throws an exception when you try to delete a property on window\n    // http://stackoverflow.com/a/1824228/751089\n    try {\n      delete window[functionName];\n    } catch (e) {\n      window[functionName] = undefined;\n    }\n  }\n\n  function removeScript(scriptId) {\n    var script = document.getElementById(scriptId);\n    if (script) {\n      document.getElementsByTagName('head')[0].removeChild(script);\n    }\n  }\n\n  function fetchJsonp(_url) {\n    var options = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];\n\n    // to avoid param reassign\n    var url = _url;\n    var timeout = options.timeout || defaultOptions.timeout;\n    var jsonpCallback = options.jsonpCallback || defaultOptions.jsonpCallback;\n\n    var timeoutId = undefined;\n\n    return new Promise(function (resolve, reject) {\n      var callbackFunction = options.jsonpCallbackFunction || generateCallbackFunction();\n      var scriptId = jsonpCallback + '_' + callbackFunction;\n\n      window[callbackFunction] = function (response) {\n        resolve({\n          ok: true,\n          // keep consistent with fetch API\n          json: function json() {\n            return Promise.resolve(response);\n          }\n        });\n\n        if (timeoutId) clearTimeout(timeoutId);\n\n        removeScript(scriptId);\n\n        clearFunction(callbackFunction);\n      };\n\n      // Check if the user set their own params, and if not add a ? to start a list of params\n      url += url.indexOf('?') === -1 ? '?' : '&';\n\n      var jsonpScript = document.createElement('script');\n      jsonpScript.setAttribute('src', '' + url + jsonpCallback + '=' + callbackFunction);\n      if (options.charset) {\n        jsonpScript.setAttribute('charset', options.charset);\n      }\n      if (options.nonce) {\n        jsonpScript.setAttribute('nonce', options.nonce);\n      }\n      if (options.referrerPolicy) {\n        jsonpScript.setAttribute('referrerPolicy', options.referrerPolicy);\n      }\n      jsonpScript.id = scriptId;\n      document.getElementsByTagName('head')[0].appendChild(jsonpScript);\n\n      timeoutId = setTimeout(function () {\n        reject(new Error('JSONP request to ' + _url + ' timed out'));\n\n        clearFunction(callbackFunction);\n        removeScript(scriptId);\n        window[callbackFunction] = function () {\n          clearFunction(callbackFunction);\n        };\n      }, timeout);\n\n      // Caught if got 404/500\n      jsonpScript.onerror = function () {\n        reject(new Error('JSONP request to ' + _url + ' failed'));\n\n        clearFunction(callbackFunction);\n        removeScript(scriptId);\n        if (timeoutId) clearTimeout(timeoutId);\n      };\n    });\n  }\n\n  // export as global function\n  /*\n  let local;\n  if (typeof global !== 'undefined') {\n    local = global;\n  } else if (typeof self !== 'undefined') {\n    local = self;\n  } else {\n    try {\n      local = Function('return this')();\n    } catch (e) {\n      throw new Error('polyfill failed because global object is unavailable in this environment');\n    }\n  }\n  local.fetchJsonp = fetchJsonp;\n  */\n\n  module.exports = fetchJsonp;\n});","import fetchJsonp from 'fetch-jsonp';\n\ntype fetchPostsParams = {\n  subreddit: string;\n  limit: number;\n  filter: string;\n  after?: string;\n  time: 'all' | 'month' | 'week' | 'day' | 'hour';\n};\n\ntype Post = {\n  data: {\n    selftext: string;\n    subreddit: string;\n    author_fullname: string;\n    gilded: number;\n  };\n};\n\nexport async function fetchPosts(params: fetchPostsParams): Promise<Post[]> {\n  const response = await jsonpApi(\n    `r/${params.subreddit}/${params.filter}`,\n    `after=${params.after}&t=${params.time}&limit=${params.time}`,\n  );\n  const { data } = await response.json();\n  return data.children;\n}\n\nasync function jsonpApi(post: string, params = '') {\n  return fetchJsonp(`https://www.reddit.com/${post}/.json?jsonp=?&${params}`, {\n    jsonpCallback: 'jsonp',\n    nonce: '',\n    referrerPolicy: '',\n  });\n}\n","export const State = (initalState = {}) => {\n  let state = initalState;\n  return {\n    set: (update) => {\n      state = { ...state, ...update };\n      return state;\n    },\n    get: (): any => state,\n  };\n};\n","import { Logger } from './logger';\nimport { fetchPosts } from './services/reddit';\nimport { State } from './state';\n\nconst getLogLevel = () => {\n  const debugMode = localStorage.getItem('debug');\n  if (debugMode || process.env.NODE_ENV === 'development') {\n    return ['debug'];\n  }\n  return [];\n};\n\nconst logger = Logger({ logLevel: getLogLevel() });\n\n(async () => {\n  const textEl = document.getElementById('text') as HTMLInputElement;\n\n  textEl.value = 'loading reddit post...';\n\n  const posts = await fetchPosts({\n    subreddit: 'BestofRedditorUpdates',\n    filter: 'top',\n    time: 'day',\n    limit: 1,\n  });\n\n  if (posts.length) {\n    textEl.value = posts[0].data.selftext;\n  }\n\n  const synth = window.speechSynthesis;\n  const state = State();\n\n  const handleVoiceSelect = (voice) => {\n    logger.debug('voice selected', voice);\n    state.set({ voice });\n  };\n\n  const handleSpeakButtonClick = () => {\n    if (!textEl.value) return;\n    const { voice } = state.get();\n    if (!voice) return;\n    speak(voice, textEl.value);\n  };\n\n  const handlePauseButtonClick = () => {\n    synth.pause();\n  }\n\n  const handleResumeButtonClick = () => {\n    synth.resume();\n  }\n\n  const handleReloadButtonClick = () => {\n    logger.debug('voice options', 'render start');\n    renderVoiceOptions({\n      onSelect: handleVoiceSelect,\n      onError: handleError,\n      initial: 0,\n    });\n  };\n\n  const handleError = (err) => {\n    renderErrorMessage(err.message);\n  };\n\n  document.getElementById('speak-btn').onclick = () => handleSpeakButtonClick();\n  document.getElementById('pause-btn').onclick = () => handlePauseButtonClick();\n  document.getElementById('resume-btn').onclick = () => handleResumeButtonClick();\n  document.getElementById('reload-btn').onclick = () =>\n    handleReloadButtonClick();\n\n  window.speechSynthesis.onvoiceschanged = () => {\n    logger.debug('voice options', 'render start');\n    renderVoiceOptions({\n      onSelect: handleVoiceSelect,\n      onError: handleError,\n      initial: 0,\n    });\n  };\n\n  function speak(voice: SpeechSynthesisVoice, text: string) {\n    logger.debug('speak', { text, voice });\n    synth.cancel();\n    const utterance = new SpeechSynthesisUtterance(text);\n    utterance.voice = voice;\n    synth.speak(utterance);\n  }\n\n  function renderVoiceOptions({ onSelect, onError, initial }) {\n    const voices = synth.getVoices();\n    if (!voices.length) {\n      return onError({ message: 'no voices available' });\n    }\n    const options = voices.map((voice, i) => ({ text: voice.name, value: i }));\n\n    const selectEl = document.getElementById('voices');\n\n    setSelectOptions(selectEl, options);\n\n    selectEl.onchange = (e) => {\n      onSelect(voices[e.target['value']]);\n    };\n\n    if (initial !== undefined) {\n      logger.debug('initial voice', voices[initial]);\n      onSelect(voices[initial]);\n    }\n  }\n\n  function setSelectOptions(selectEl, options) {\n    selectEl.innerHTML = '';\n    options.forEach((option) => {\n      const optionEl = document.createElement('option');\n      optionEl.value = option.value;\n      optionEl.text = option.text;\n      selectEl.appendChild(optionEl);\n    });\n  }\n\n  function renderErrorMessage(message: string) {\n    alert(message);\n  }\n})();\n"]}